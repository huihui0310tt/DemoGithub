<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Team1</title>

    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script> 
    <script src="https://cdn.jsdelivr.net/npm/@aspnet/signalr@1.1.0/dist/browser/signalr.js"></script>
   <!--
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
   --> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

  <!-- ###########https://ithelp.ithome.com.tw/articles/10222623-->
  <style>
    .bd-placeholder-img {
      font-size: 1.125rem;
      text-anchor: middle;
      -webkit-user-select: none;
      -moz-user-select: none;
      user-select: none;
    }

    @media (min-width: 768px) {
      .bd-placeholder-img-lg {
        font-size: 3.5rem;
      }
    }

    .b-example-divider {
      height: 3rem;
      background-color: rgba(0, 0, 0, .1);
      border: solid rgba(0, 0, 0, .15);
      border-width: 1px 0;
      box-shadow: inset 0 .5em 1.5em rgba(0, 0, 0, .1), inset 0 .125em .5em rgba(0, 0, 0, .15);
    }

    .b-example-vr {
      flex-shrink: 0;
      width: 1.5rem;
      height: 100vh;
    }

    .bi {
      vertical-align: -.125em;
      fill: currentColor;
    }

    .nav-scroller {
      position: relative;
      z-index: 2;
      height: 2.75rem;
      overflow-y: hidden;
    }

    .nav-scroller .nav {
      display: flex;
      flex-wrap: nowrap;
      padding-bottom: 1rem;
      margin-top: -1px;
      overflow-x: auto;
      text-align: center;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
  </style>

    
    <!-- Custom styles for this template -->
    <!-- <link href="dashboard.css" rel="stylesheet"> -->
  </head>
  <header>
    <div class="collapse bg-dark" id="navbarHeader">
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-md-7 py-4">
            <h4 class="text-white">Abstract</h4>
            <p class="text-white">當今的手機App無法同時掃描電子發票以及傳統發票，即使宣稱可以一起掃描，但使用上，在掃瞄各種發票時仍舊需要切換至不同App頁面，因此希望透過Final Project，透過Azure提供的資源來整合這個功能。</p>
          </div>
          <div class="col-sm-4 offset-md-1 py-4">
            <h4 class="text-white">Team1 - Members</h4>
            <ul class="list-unstyled">
              <li><a href="#" class="text-white">11177034 - 王派霆</a></li>
              <li><a href="#" class="text-white">11177035 - 林彥輝</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="navbar navbar-dark bg-dark shadow-sm">
      <div class="container">
        <a href="#" class="navbar-brand d-flex align-items-center">
          <svg fill="#b25110" height="64px" width="64px" version="1.1" id="SVGRepoEditor" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 60.00 60.00" xml:space="preserve" stroke="#b25110" stroke-width="0" transform="matrix(1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g> <path d="M60,4.293c0-2.206-1.794-4-4-4H4c-2.206,0-4,1.794-4,4c0,1.859,1.28,3.411,3,3.858v48.556l3-3l6,6l6-6l6,6l6-6l6,6l6-6l6,6 l6-6l3,3V8.151C58.72,7.704,60,6.152,60,4.293z M55,51.879l-1-1l-6,6l-6-6l-6,6l-6-6l-6,6l-6-6l-6,6l-6-6l-1,1V8.293v-3h50v3 V51.879z M57,6.024V3.293H3v2.731C2.403,5.679,2,5.032,2,4.293c0-1.103,0.897-2,2-2h52c1.103,0,2,0.897,2,2 C58,5.032,57.597,5.679,57,6.024z"></path> <path d="M44,40.293H29c-0.552,0-1,0.447-1,1s0.448,1,1,1h15c0.552,0,1-0.447,1-1S44.552,40.293,44,40.293z"></path> <path d="M48.29,40.583c-0.18,0.189-0.29,0.439-0.29,0.71c0,0.26,0.11,0.52,0.29,0.71c0.19,0.18,0.45,0.29,0.71,0.29 c0.26,0,0.52-0.11,0.71-0.29c0.18-0.19,0.29-0.45,0.29-0.71c0-0.271-0.11-0.521-0.29-0.71C49.33,40.213,48.67,40.213,48.29,40.583z "></path> <path d="M49,26.293H34c-0.552,0-1,0.447-1,1s0.448,1,1,1h15c0.552,0,1-0.447,1-1S49.552,26.293,49,26.293z"></path> <path d="M49,33.293H39c-0.552,0-1,0.447-1,1s0.448,1,1,1h10c0.552,0,1-0.447,1-1S49.552,33.293,49,33.293z"></path> <path d="M28,34.293c0,0.553,0.448,1,1,1h2c0.552,0,1-0.447,1-1s-0.448-1-1-1h-2C28.448,33.293,28,33.74,28,34.293z"></path> <path d="M45,20.293c0-0.553-0.448-1-1-1H29c-0.552,0-1,0.447-1,1s0.448,1,1,1h15C44.552,21.293,45,20.846,45,20.293z"></path> <path d="M48.29,19.583c-0.18,0.189-0.29,0.439-0.29,0.71c0,0.26,0.11,0.52,0.29,0.71c0.19,0.18,0.45,0.29,0.71,0.29 c0.27,0,0.52-0.11,0.71-0.29c0.18-0.19,0.29-0.45,0.29-0.71s-0.11-0.521-0.29-0.71C49.34,19.213,48.66,19.213,48.29,19.583z"></path> <path d="M30.71,28.003c0.18-0.19,0.29-0.44,0.29-0.71c0-0.271-0.11-0.521-0.29-0.71c-0.37-0.37-1.04-0.37-1.42,0 c-0.18,0.189-0.29,0.439-0.29,0.71c0,0.27,0.11,0.52,0.29,0.71c0.19,0.18,0.45,0.29,0.71,0.29 C30.26,28.293,30.52,28.183,30.71,28.003z"></path> <path d="M35.71,35.003c0.18-0.19,0.29-0.44,0.29-0.71c0-0.271-0.11-0.53-0.29-0.71c-0.37-0.37-1.04-0.37-1.42,0 c-0.18,0.189-0.29,0.45-0.29,0.71s0.11,0.52,0.29,0.71c0.19,0.18,0.45,0.29,0.71,0.29C35.26,35.293,35.52,35.183,35.71,35.003z"></path> <path d="M17,21.394v-1.101c0-0.553-0.448-1-1-1s-1,0.447-1,1v1.104c-1.091,0.222-2.085,0.801-2.818,1.668 c-0.611,0.722-0.894,1.646-0.794,2.603c0.102,0.979,0.606,1.887,1.383,2.491L15,29.893v5.438c-1.161-0.414-2-1.514-2-2.816 c0-0.553-0.448-1-1-1s-1,0.447-1,1c0,2.414,1.721,4.434,4,4.899v0.878c0,0.553,0.448,1,1,1s1-0.447,1-1v-0.882 c1.091-0.222,2.085-0.801,2.819-1.668c0.611-0.724,0.893-1.648,0.793-2.605c-0.103-0.978-0.606-1.885-1.383-2.488L17,28.916v-5.438 c1.161,0.414,2,1.514,2,2.816c0,0.553,0.448,1,1,1s1-0.447,1-1C21,23.879,19.279,21.859,17,21.394z M18.001,32.228 c0.349,0.271,0.576,0.68,0.622,1.118c0.043,0.41-0.075,0.803-0.331,1.105c-0.348,0.411-0.798,0.699-1.292,0.875v-3.878 L18.001,32.228z M13.999,26.581c-0.35-0.272-0.576-0.681-0.622-1.12c-0.042-0.409,0.075-0.801,0.331-1.104 c0.348-0.411,0.798-0.699,1.292-0.875v3.877L13.999,26.581z"></path> <circle cx="40" cy="11.293" r="1"></circle> <circle cx="36" cy="11.293" r="1"></circle> <circle cx="44" cy="11.293" r="1"></circle> <circle cx="32" cy="11.293" r="1"></circle> <circle cx="48" cy="11.293" r="1"></circle> <circle cx="20" cy="11.293" r="1"></circle> <circle cx="24" cy="11.293" r="1"></circle> <circle cx="28" cy="11.293" r="1"></circle> <circle cx="52" cy="11.293" r="1"></circle> <circle cx="16" cy="11.293" r="1"></circle> <circle cx="12" cy="11.293" r="1"></circle> <circle cx="8" cy="11.293" r="1"></circle> </svg>
          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true" class="me-2" viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg> -->
          <strong> - Uniform Invoice Recognition - </strong>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>
    </div>
  </header>

  <body>

  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Camera Section</h1>
  </div>


    <video src="" ></video>
    <canvas style="border:solid 1px #ddd;background-color:white;" id="canvas" width="600" height="400"></canvas>
    <video src="" ></video>

    <p></p>
      Name: <input type="text" id ="username" size="10" value="Guest" name="username" />
      <div id="datetime"> </div>   
      <input type="button" id="btnsave" name="btnsave" value="Screenshot!" />  

  






      <h2>Check Results</h2>
      <div class="table-responsive">
        <table class="table table-striped table-sm" id="LeaderboardTable">
          <thead>
            <tr>
              <th scope="col">Timestamp</th>
              <th scope="col">Name</th>
              <th scope="col">ReciptType</th>
              <th scope="col">InvoiceID</th>
              <th scope="col">Result</th>
            </tr>
          </thead>
          <tbody>

          </tbody>
        </table>
      </div>
      <br><br><br><br><br><br><br><br><br><br><br>
      <div  id="chatroom">
        This is Debug Chatroom
        <textarea name="chat_room" cols = 45 rows = 20 id="messages"  readonly class="align-middle"></textarea>
      </div> 

    </main>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <!-- 
          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>

          <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    -->
    
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>  
    

   

      <script>
        var front = false;
        var video = document.querySelector('video');
        <!--  160 120 -->
        var constraints = { video: { facingMode: (front? "user" : "environment"), width: 600, height: 400  } }; 
     
        navigator.mediaDevices.getUserMedia(constraints)
          .then(function(mediaStream) {
            video.srcObject = mediaStream;
            video.onloadedmetadata = function(e) {
            video.play();
            };
          })
        .catch(function(err) { console.log(err.name + ": " + err.message); })
      </script> 
      
      <script>
        setInterval(myTimer, 1000);
      
        function myTimer() {
          const d = new Date();
          document.getElementById("datetime").innerHTML = d.toTimeString().substring(0,18);
        } 
      </script>
      
      <script type="text/javascript">  
          // Below code to capture image from Video tag (Webcam streaming)  
          $("#btnsave").click( function () {  
              var canvas = document.getElementById('canvas');  
              var context = canvas.getContext('2d');  
        
              // Capture the image into canvas from Webcam streaming Video element  
              context.drawImage(video, 0, 0);  
      
              // Get base64 data to send to server for upload  
              var imagebase64data = canvas.toDataURL("image/jpeg");  
              imagebase64data = imagebase64data.replace('data:image/jpeg;base64,', '');  
          console.log(imagebase64data)
          var dataJson = {};
          dataJson["username"] = document.getElementById("username").value ;
          dataJson["datetime"] = document.getElementById("datetime").innerText ;
          dataJson["imageData"] = imagebase64data
              $.ajax({  
                  type: 'POST',  
                  url: 'https://11177035-functionapp.azurewebsites.net/api/RecepitRecognition',  
                  data: JSON.stringify( dataJson ),  
                  contentType: 'application/json; charset=utf-8',  
                  dataType: 'text',  
                  success: function (out) {  
                      alert('Image uploaded successfully..');  
                  }  
              });  
        });
      </script>  
      
      <script async>
        var myArray = [];
      
        let messages = document.querySelector('#messages');
        // const apiBaseUrl = window.location.origin;
        const apiBaseUrl_serverless = 'https://11177035-functionapp.azurewebsites.net';
      
        //   messages.innerHTML += 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n"
      
        const connection_serverless = new signalR.HubConnectionBuilder()
          .withUrl(apiBaseUrl_serverless + '/api')
          .configureLogging(signalR.LogLevel.Information)
          .build();
          connection_serverless.on('newMessage', (message) => {
          console.log(message)
          messages.innerHTML += message + "\n"
// Start From Here!
          const apiBaseUrl = 'https://11177035-webapp.azurewebsites.net/getallresult' ;
              
              $.ajax({
                    type: "POST",
                    url: apiBaseUrl,
                    data: JSON.parse(message),
                    success: function (data) {
                      console.log(data);
                      console.log('abc');
                      show(data);
                    },
                    dataType: "json"
                  });

                  // show(result);
                  function show(data) {
                    let tab = 
                      `<tr>
                      <th>Timestamp</th>
                      <th>Name</th>
                      <th>ReciptType</th>
                      <th>InvoiceID</th>
                      <th>Result</th>
                      </tr>`;
                    
                    // Loop to access all rows 
                    for (let r of data) {
                      tab += `<tr> 
                      <td>${r.Timestamp} </td>
                      <td>${r.Name}</td>
                      <td>${r.ReciptType}</td>      
                      <td>${r.InvoiceID}</td>
                      <td>${r.Result}</td>      
                      </tr>`;
                    }
                    // Setting innerHTML as tab variable
                    document.getElementById("LeaderboardTable").innerHTML = tab;
                  }

// End from here!
          });
      
      
      
          console.log(apiBaseUrl_serverless)
          connection_serverless.start()
          .catch(console.error);
        </script>
 
 <script async>        // This is for debugMessage
  var myArray = [];

  // const apiBaseUrl = window.location.origin;

  //   messages.innerHTML += 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n" + 1 + "\n"

  const connection_serverless2 = new signalR.HubConnectionBuilder()
    .withUrl(apiBaseUrl_serverless + '/api')
    .configureLogging(signalR.LogLevel.Information)
    .build();
    connection_serverless.on('debugMessage', (message) => {
    console.log(message)
    messages.innerHTML += message + "\n"
    });

    connection_serverless2.start()
    .catch(console.error);
  </script>


    </body>


</html>
